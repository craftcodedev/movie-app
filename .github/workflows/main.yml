name: CI

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: define variables
        run: echo define variables
        env:
          APP_NAME = "movil-app"
          ENVIRONMENT = "dev"
          RELEASE_VERSION = ${GITHUB_SHA}
          REGISTRY = "eu.gcr.io/craft-code-255613/${APP_NAME}-${ENVIRONMENT}"
          IMAGE = "${REGISTRY}:${RELEASE_VERSION}"
      - name: build
        run: docker build . --file etc/docker/Dockerfile --tag ${IMAGE}
      - name: tests
        run: docker run -w /var/app/ -i ${IMAGE} node_modules/mocha/bin/mocha

      #a√±ado el uso de artefactos: todo el codigo compilado lo publico en algun sitio donde un job(deploy) siguiente pueda recogerlo y desplegarlo
      #- name: publish de code
      #- name: 